#!/usr/bin/env bash
#
# This script uses rsync to synchronize the local ~/code/ncrmro/ directory
# with a remote host named 'ocean' at ~/code/ncrmro/.
# It excludes common development-related directories and large files
# to speed up the synchronization process and save bandwidth.
#
# Usage: ./rsync-code
#
# Options:
# -a, --archive: archive mode; equals -rlptgoD (no -H,-A,-X).
# -v, --verbose: increase verbosity.
# -z, --compress: compress file data during the transfer.
# --delete: (Optional) delete extraneous files from destination dirs.
#           This option is prompted for confirmation before execution.
# --partial: keep partially transferred files.
# --info=progress2: show progress during transfer.
#
# Excludes:
# - .git/: Git repository files.
# - node_modules/: Node.js dependencies.
# - venv/, .venv/: Python virtual environments.
# - __pycache__/: Python cache files.
# - target/: Rust compilation output.
# - .embuild/: Emscripten build output.
# - .next/: Next.js build output.
# - dist/, build/: Generic build output directories.
# - .cache/: Cache directories.
# - *.iso, *.qcow, *.qcow2, *.img, *.vdi, *.vmdk: Large disk image files.
#

DELETE_FLAG=""
read -p "Do you want to enable --delete (remove extraneous files from destination)? (y/N): " -n 1 -r
echo    # (optional) move to a new line
RSYNC_ARGS=(-avz --partial --info=progress2)

if [[ $REPLY =~ ^[Yy]$ ]]
then
    RSYNC_ARGS+=(--delete)
    echo "Deletion enabled."
else
    echo "Deletion disabled."
fi

rsync "${RSYNC_ARGS[@]}" \
  --exclude='.git/' \
  --exclude='node_modules/' \
  --exclude='**/node_modules/' \
  --exclude='venv/' \
  --exclude='.venv/' \
  --exclude='**/venv/' \
  --exclude='**/.venv/' \
  --exclude='__pycache__/' \
  --exclude='**/__pycache__/' \
  --exclude='target/' \
  --exclude='**/target/' \
  --exclude='.embuild/' \
  --exclude='**/.embuild/' \
  --exclude='.next/' \
  --exclude='**/.next/' \
  --exclude='dist/' \
  --exclude='**/dist/' \
  --exclude='build/' \
  --exclude='**/build/' \
  --exclude='.cache/' \
  --exclude='**/.cache/' \
  --exclude='*.iso' \
  --exclude='*.qcow' \
  --exclude='*.qcow2' \
  --exclude='*.img' \
  --exclude='*.vdi' \
  --exclude='*.vmdk' \
  ~/code/ncrmro/ \
  ocean:~/code/ncrmro/

