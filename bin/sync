#!/bin/bash
set -e

git add .
nix flake check
/home/ncrmro/.nix-profile/bin/alejandra .
echo "Syncing to mox"
rsync --recursive --verbose --delete --exclude .git ./ root@192.168.1.118:/etc/nixos/flake/
echo "Rebuilding mox"
ssh root@192.168.1.118 nixos-rebuild switch --flake /etc/nixos/flake/#mox
echo "Switching home-manager on mox"
ssh ncrmro@192.168.1.118 home-manager switch --flake /etc/nixos/flake/#ncrmro@mox
